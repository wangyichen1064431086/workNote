## XSS

Cross Site Script,跨站脚本攻击。是指攻击者在网站上注入恶意客户端代码，通过恶意脚本对客户端网页进行篡改，从而在用户浏览网页时，对用户浏览器进行控制或者获取用户隐私数据的一种攻击方式。

### 容易发生的场景

(1)数据从一个不可靠的链接进入到一个web应用程序。

(2)没有过滤掉恶意代码的动态内容被发送给web用户。

### XSS攻击的共同点
将一些隐私数据如cookie、session发送给攻击者，将受害者重定向到一个由攻击者控制的网站，在受害者机器上进行恶意操作。

### XSS攻击的类型
分为存储性（持久型）、反射型（非持久型）、基于DOM

#### 1. 反射型
反射型XSS攻击把用户输入的数据"反射"给浏览器。该攻击方式通常诱使用户 **点击一个恶意链接**，或者 **提交一个表单**, 在用户点击链接或提交表单的同时向用户访问的网站注入脚本。

##### 实践：模拟反射型XSS攻击

#### 2. 存储型

存储型XSS把用户输入的带有恶意脚本的数据存储在服务器端。当浏览器请求数据时，服务器返回脚本并执行。

常见的场景是攻击者在社区或论坛上写下一篇包含恶意 JavaScript 代码的文章或评论，文章或评论发表后，所有访问该文章或评论的用户，都会在他们的浏览器中执行这段恶意的 JavaScript 代码。

##### 实践：模拟存储型XSS攻击

#### 3. 基于DOM

基于DOM的XSS是指通过恶意脚本修改页面的DOM结构。是存萃发生在 **客户端**的攻击。

##### 实践：模拟基于DOM的XSS攻击

### XSS攻击的防范

### 1. 现代主流浏览器内置CSP
内容安全策略（CSP）用于检测和减轻用于 Web 站点的特定类型的攻击，例如 XSS 和数据注入等。通过 **Content-Security-Policy**HTTP头实现。

### 2. HttpOnly阻止Cookie劫持攻击
浏览器会禁止页面的JavaScript访问带有HttpOnly属性的Cookie。如果您在cookie中设置了HttpOnly属性，那么通过js脚本将无法读取到cookie信息，这样能有效的防止XSS攻击。

如上所述，发起XSS的攻击者既然可以通过注入恶意脚本获取用户的 Cookie 信息。所以，严格来说，HttpOnly 并非阻止 XSS 攻击，而是能阻止 XSS 攻击后的 Cookie 劫持攻击。

### 3. 输入检查/XSS Filter
 对于用户的任何输入要进行检查、过滤和转义。一般是检查用户输入的数据中是否包含 <，>,script 等特殊字符，如果存在，则对特殊字符进行过滤或编码。

 一些前端框架中，都有一份decodingMap(***待研究***),会对用户输入所包含的特殊字符或标签进行编码或过滤，以防止XSS攻击。

#### vue中的decodingMap

```js
// 在 vuejs 中，如果输入带 script 标签的内容，会直接过滤掉

const decodingMap = {

  '&lt;': '<',

  '&gt;': '>',

  '&quot;': '"',

  '&amp;': '&',

  '

  ': '\n'

}


```

### 4. 输出检查
在变量输出到 HTML 页面时，可以使用编码或转义（***待研究***）的方式来防御 XSS 攻击。

## CSRF

Cross Site Request Forgery,跨站攻击伪造。是劫持受信任用户向服务器发送非预期请求的攻击方式。

通常情况下，CSRF 攻击是攻击者借助受害者的 Cookie 骗取服务器的信任，可以在受害者毫不知情的情况下以受害者名义伪造请求发送给受攻击服务器，从而在并未授权的情况下执行在权限保护之下的操作。

## 参考资料
<https://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&mid=2651554578&idx=1&sn=89a1743e018bf221688172c96bb4e866&pass_ticket=6PzWxTA51OOBq1JgjhHUaRahdKfET6zcK10abJElQxXb2%2BQmGJQBCisOE3z%2B53bb>

<https://developer.mozilla.org/zh-CN/docs/Glossary/CSP>

<https://developer.mozilla.org/zh-CN/docs/Glossary/Cross-site_scripting>